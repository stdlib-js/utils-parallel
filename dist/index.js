"use strict";var p=function(e,r){return function(){return r||e((r={exports:{}}).exports,r),r.exports}};var B=p(function(Rr,T){
var R=require('@stdlib/os-num-cpus/dist');function $(){return{workers:R-1,concurrency:R-1,cmd:"node",ordered:!1,uid:null,gid:null,encoding:"buffer",maxBuffer:200*1024*1024}}T.exports=$
});var K=p(function(Tr,I){
var rr=require('@stdlib/assert-is-plain-object/dist'),w=require('@stdlib/assert-has-own-property/dist'),_=require('@stdlib/assert-is-positive-integer/dist').isPrimitive,E=require('@stdlib/assert-is-nonnegative-integer/dist').isPrimitive,er=require('@stdlib/assert-is-boolean/dist').isPrimitive,ir=require('@stdlib/assert-is-string/dist').isPrimitive,v=require('@stdlib/error-tools-fmtprodmsg/dist');function nr(e,r){return rr(r)?w(r,"concurrency")&&(e.concurrency=r.concurrency,!_(e.concurrency))?new TypeError(v('1WZ3P',"concurrency",e.concurrency)):w(r,"workers")&&(e.workers=r.workers,!_(e.workers))?new TypeError(v('1WZ3P',"workers",e.workers)):w(r,"cmd")&&(e.cmd=r.cmd,!ir(e.cmd))?new TypeError(v('1WZ2W',"cmd",e.cmd)):w(r,"ordered")&&(e.ordered=r.ordered,!er(e.ordered))?new TypeError(v('1WZ2o',"ordered",e.ordered)):w(r,"uid")&&(e.uid=r.uid,!E(e.uid))?new TypeError(v('1WZ2t',"uid",e.uid)):w(r,"gid")&&(e.gid=r.gid,!E(e.gid))?new TypeError(v('1WZ2t',"gid",e.gid)):w(r,"maxBuffer")&&(e.maxBuffer=r.maxBuffer,!E(e.maxBuffer))?new TypeError(v('1WZ2t',"maxBuffer",e.maxBuffer)):null:new TypeError(v('1WZ2V',r));}I.exports=nr
});var W=p(function(Br,D){
var tr=require('@stdlib/utils-keys/dist'),P=require('@stdlib/process-env/dist');function ur(){var e,r,a,o;for(e=tr(P),a={},o=0;o<e.length;o++)r=e[o],a[r]=P[r];return a}function dr(e){var r=ur();return r.WORKER_CMD=e.cmd,r.WORKER_ENCODING=e.encoding,r.WORKER_MAX_BUFFER=e.maxBuffer,e.ordered&&(r.WORKER_ORDERED="1"),e.uid&&(r.WORKER_UID=e.uid),e.gid&&(r.WORKER_GID=e.gid),r}D.exports=dr
});var j=p(function(_r,N){
var ar=require('@stdlib/process-cwd/dist'),or=W();function cr(e){var r={cwd:ar(),env:or(e),stdio:"inherit"};return e.uid&&(r.uid=e.uid),e.gid&&(r.gid=e.gid),r}N.exports=cr
});var A=p(function(Ir,S){
var sr=require("child_process").fork,fr=require("path"),vr=require("debug"),O=require('@stdlib/utils-keys/dist'),F=require('@stdlib/error-tools-fmtprodmsg/dist'),lr=j(),u=vr("parallel:exec"),gr=fr.resolve(__dirname,"./worker/index.js");function mr(e,r,a){var o,c,l,f,y,d,x,k,g,h,m;for(u("Options: %s.",JSON.stringify(r)),o=0,u("Creating %d workers...",r.workers),c={},y=[],f=lr(r),m=0;m<r.workers;m++)u("Creating child process..."),d=sr(gr,y,f),d.on("error",Y(d)),d.on("close",L(d)),d.on("exit",z(d)),d.on("disconnect",Q(d)),d.on("message",J(d)),u("Child process created. pid: %d.",d.pid),c[d.pid]=d;for(x=O(c),u("%d workers created.",x.length),u("Running %d scripts concurrently...",r.concurrency),l={},g=-1,m=0;m<r.concurrency;m++)k=x[m%x.length],b(c[k]);function b(n){var t;if(g+=1,g>=e.length){if(t=O(l).length,t>0){u("%d scripts are pending.",t);return}return u("All scripts have finished."),q()}u("Instructing child process to run script: %s. pid: %d.",e[g],n.pid),n.send(e[g]),l[e[g]]=!0,u("%d of %d scripts have been processed.",g,e.length)}function J(n){return t;function t(i){u("Child process message: %s. pid: %d.",i,n.pid),delete l[i],b(n)}}function L(n){return t;function t(i,s){u("Child process closed. Code: %d. Signal: %s. pid: %d.",i,s,n.pid),C(i,s),X()}}function X(){o+=1,u("%d of %d child processes have closed.",o,r.workers),o===r.workers&&Z()}function z(n){return t;function t(i,s){u("Child process exited. Code: %d. Signal: %s. pid: %d.",i,s,n.pid),C(i,s)}}function q(n){var t,i,s;for(n&&!h&&(h=n),u("Instructing child processes to close..."),t=O(c),s=0;s<t.length;s++)i=t[s],u("Instructing child process (pid: %d) to close...",i),c[i].send("close")}function Q(n){return t;function t(){u("Child process disconnected. pid: %d.",n.pid)}}function Y(n){return t;function t(i){u("Child process error: %s. pid: %d.",i.message,n.pid),q(i)}}function C(n,t){var i;if(!h&&(n!==null&&n!==0?i=new Error(F('1WZBi',n)):t!==null&&(i=new Error(F('1WZBj',t))),i))return i.code=n,i.signal=t,q(i)}function Z(){if(h)return a(h);a()}}S.exports=mr
});var M=p(function(Kr,V){
var pr=A();V.exports=pr
});var H=p(function(Pr,G){
var wr=require("path"),hr=require('@stdlib/assert-is-string-array/dist').primitives,yr=require('@stdlib/assert-is-function/dist'),U=require('@stdlib/error-tools-fmtprodmsg/dist'),xr=require('@stdlib/process-cwd/dist'),qr=B(),Er=K(),Or=M();function kr(){var e,r,a,o,c,l,f;if(r=arguments[0],!hr(r))throw new TypeError(U('1WZ3s',r));if(r=r.slice(),a=qr(),arguments.length>2){if(e=arguments[1],o=arguments[2],c=Er(a,e),c)throw c}else o=arguments[1];if(!yr(o))throw new TypeError(U('1WZ2b',o));for(a.concurrency>r.length&&(a.concurrency=r.length),a.workers>a.concurrency&&(a.workers=a.concurrency),l=xr(),f=0;f<r.length;f++)r[f]=wr.resolve(l,r[f]);Or(r,a,y);function y(d){if(d)return o(d);o()}}G.exports=kr
});var br=H();module.exports=br;
/** @license Apache-2.0 */
//# sourceMappingURL=index.js.map
